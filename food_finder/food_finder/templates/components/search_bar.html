<form id="searchForm">
    <!-- The input for the search query with autocomplete -->
    <input type="search" id="autocomplete" name="query" placeholder="i.e. South City Kitchen Midtown, Chinese, Buckhead"
        required>
</form>

<!-- Add the Google Places API Script -->
<script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAB4mZM4o2Oe4_-ZHmH9gTI3o-gj00pEg4&libraries=places"></script>

<script>
    // Function to initialize Google Places Autocomplete with location bounds
    function initAutocomplete(position) {
        const input = document.getElementById('autocomplete');

        // Create a bounds object centered around the user's location
        const userLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

        const options = {
            bounds: new google.maps.LatLngBounds(userLocation),  // Bound results around the user
            types: ['restaurant'],
            componentRestrictions: { country: 'us' }
        };

        // Initialize autocomplete with the options
        const autocomplete = new google.maps.places.Autocomplete(input, options);

        // Add listener for place selection
        autocomplete.addListener('place_changed', function () {
            const place = autocomplete.getPlace();
            console.log(place);
        });
    }

    // Function to get user's current location
    function getUserLocation() {
        // Check if browser supports Geolocation API
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(initAutocomplete, handleLocationError);
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    }

    // Handle location errors (e.g., user denies location access)
    function handleLocationError(error) {
        console.error("Error retrieving location: ", error.message);
        alert("Could not retrieve your location. Please enable location services or enter manually.");
    }

    // Handle form submission
    document.getElementById('searchForm').addEventListener('submit', function (event) {
        event.preventDefault(); // Prevent form submission

        const query = document.getElementById('autocomplete').value; // Get the search query
        if (query) {
            // Redirect to restaurants.html with query as a parameter
            window.location.href = `restaurants.html?query=${encodeURIComponent(query)}`;
        }
    });

    // Initialize getting user's location when the page loads
    window.onload = function () {
        getUserLocation();  // Get user's location and initialize autocomplete
    };
</script>

<style>
    /* Styling the search bar */
    form {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    #autocomplete {
        width: 750px;
        height: 50px;
        padding: 10px 20px;
        border: 1px solid #ccc;
        border-radius: 50px;
        font-size: 16px;
        box-shadow: 0px 2px 8px rgba(0, 0, 0, 0.1);
        outline: none;
        transition: box-shadow 0.3s ease-in-out;
        background-color: #E9E9E9;
    }

    #autocomplete:focus {
        box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.2);
    }
</style>